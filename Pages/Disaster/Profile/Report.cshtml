@page
@model AgapayAidSystem.Pages.Disaster.Profile.ReportModel
@{
	ViewData["Title"] = "Report";
}

<style>
    .table {
        margin: 0 auto; /* Center-align the table */
        text-align: center; /* Left-align the table contents */
        border-radius: 20px;
    }

        .table th {
            vertical-align: middle;
        }

        .table th {
            background: #3F8F8B;
            color: #fff;
        }

    /* Adjust the left-aligned text in the first column */
    .left-aligned {
        text-align: left;
    }

    .report-container {
        display: flex;
        justify-content: space-between;
        padding: 10px;
    }

    .col, .col-auto {
        flex: 1;
    }
</style>

<div class="content" id="makepdf">
    <a class="navbar-brand pb-2">
        <img src="/green-logo-horizontal.png" alt="" height="45" id="logo">
    </a>

    <hr /><br />

    <div class="row">
        <!-- REPORT INFORMATION -->
        <div class="col left-aligned order-1">
            <p><strong>Province:</strong> NCR</p>
            <p><strong>City/Municipality:</strong> Manila</p>
            <p><strong>Report Number:</strong> 00001</p>
        </div>
        <div class="col-auto left-aligned order-2">
            <p><strong>Date of Report Generated:</strong> 01/11/2021 10:18:20</p>
            <p><strong>Generated by:</strong> John Doe</p>
        </div>
    </div>

    <br />

    <!--DISASTER INFORMATION-->
    <div>
        <h4 class="pb-2"><strong>DISASTER INFORMATION:</strong></h4>


        <p>
            <strong>Name:</strong>
            Gaya Gaya Fire
        </p>
        <p>
            <strong>Type:</strong>
            Fire
        </p>
        <p>
            <strong>Description:</strong>
            Caused due to LPG Tank
        </p>
        <p>
            <strong>Date Occurred:</strong>
            12/29/2020
        </p>
    </div>

    <br />

    <div>
        <h4 class="pb-2"><strong>STATUS OF DISASTER OPERATIONS:</strong></h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th class="center-header" rowspan="4">AFFECTED BARANGAY</th>
                    <th colspan="3" rowspan="3">NUMBER AFFECTED</th>
                    <th colspan="2" rowspan="3">NUMBER OF ECs</th>
                    <th colspan="4">SERVED</th>
                    <th colspan="4" rowspan="3">TOTAL SERVED</th>
                </tr>
                <tr>
                    <th colspan="4">Inside E.C</th>
                </tr>
                <tr>
                    <th>Families</th>
                    <th>Persons</th>

                    <th>Families</th>
                    <th>Persons</th>
                </tr>
                <tr>
                    <th>Barangay</th>
                    <th>Families</th>
                    <th>Persons</th>

                    <th>Cum</th>
                    <th>Now</th>

                    <th>Cum</th>
                    <th>Now</th>

                    <th>Cum</th>
                    <th>Now</th>

                    <th>Cum</th>
                    <th>Now</th>

                    <th>Cum</th>
                    <th>Now</th>
                </tr>

            </thead>

            <tbody>
                <tr>
                    <td>Barangay A</td>
                    <td>50</td>
                    <td>60</td>
                    <td>30</td>
                    <td>80</td>
                    <td>10</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                </tr>
                <tr>
                    <td>Barangay B</td>
                    <td>50</td>
                    <td>60</td>
                    <td>30</td>
                    <td>80</td>
                    <td>10</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                </tr>
                <tr>
                    <td>Barangay B</td>
                    <td>50</td>
                    <td>60</td>
                    <td>30</td>
                    <td>80</td>
                    <td>10</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                    <td>20</td>
                </tr>
            </tbody>

            <tfoot>
                <tr>
                    <th>SUB-TOTAL</th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<div class="content">
    <input type="hidden" name="disasterID" value="@Model.disasterInfo.disasterID" />
    <a href="/disaster/profile/index?disasterID=@Model.disasterInfo.disasterID" role="button" class="btn btn-secondary">Go Back</a>
    <button class="btn btn-primary" id="button">Save as PDF</button>
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
<script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>

<script>
    // Create PDF from HTML...
    function CreatePDFfromHTML() {
        var HTML_Width = $("#makepdf").width();
        var HTML_Height = $("#makepdf").height();
        var top_left_margin = 15;
        var PDF_Width = HTML_Width + (top_left_margin * 2);
        var PDF_Height = HTML_Height + (top_left_margin * 2);
        var canvas_image_width = HTML_Width;
        var canvas_image_height = HTML_Height;

        var totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;

        html2canvas($("#makepdf")[0]).then(function (canvas) {
            var imgData = canvas.toDataURL("image/jpeg", 1.0);
            var pdf = new jsPDF('l', 'pt', [PDF_Width, PDF_Height]); // 'l' for landscape
            pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, canvas_image_width, canvas_image_height);
            for (var i = 1; i <= totalPDFPages; i++) {
                pdf.addPage('l', 'pt', [PDF_Width, PDF_Height]);
                pdf.addImage(imgData, 'JPG', top_left_margin, -(PDF_Height * i) + (top_left_margin * 4), canvas_image_width, canvas_image_height);
            }
            pdf.save("Agapay Aid Report.pdf");
            $("#makepdf").show(); // Show the content after generating PDF
        });
    }

    // Add event listener to the button
    document.getElementById('button').addEventListener('click', function () {
        CreatePDFfromHTML();
    });
</script>

