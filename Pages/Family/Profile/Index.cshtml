@page
@model AgapayAidSystem.Pages.Family.Profile.IndexModel
@{
	string pageTitle = $"{Model.familyInfo.serialNum}";
	ViewData["Title"] = pageTitle;
}

<div class="content">
	<input type="hidden" name="familyID" value="@Model.familyInfo.familyID" />
	<!-- Breadcrumb -->
	<div class="row p-2">
		<div class="breadcrumb-container">
			<div aria-label="breadcrumb">
				<ol class="breadcrumbs">
					<li><a href="/index"><i class="bi bi-house-door-fill" style="padding: 5px;"></i>Home</a></li>
					<li class="divider"> > </li>
					<li><a href="/family/index">Family</a></li>
					<li class="divider"> > </li>
					<li><a class="active">@Model.familyInfo.serialNum</a></li>
				</ol>
			</div>
		</div>
	</div>

	<!-- Title, Info Button, Menu Button -->
	<div class="row p-2">
		<div class="col d-flex align-items-center">
			<h1>@Model.familyInfo.serialNum</h1>
		</div>

		<div class="col-auto button-spacer">
			<!-- Button with text and icon (visible on larger screens) -->
			<button id="toggleButton" class="btn btn-light d-none d-md-inline-block" style="padding:5px">
				<i class="bi bi-info-circle-fill"></i> Info
			</button>

			<!-- Button with only the icon (collapsed on smaller screens) -->
			<button id="toggleButtonMobile" class="btn btn-light d-inline-block d-md-none">
				<i class="bi bi-info-circle-fill"></i>
			</button>

			<div class="d-inline position-relative">
				<a href="#" role="button" id="recordOptions" data-bs-toggle="dropdown" aria-expanded="false">
					<i class="bi bi-three-dots-vertical"></i>
				</a>
				<ul class="dropdown-menu" aria-labelledby="recordOptions">
					<li>
						<a class="dropdown-item" href="/family/profile/edit/family?familyID=@Model.familyInfo.familyID">
							Edit Family Info
						</a>
					</li>
					<li>
						<a href="#" class="text-danger dropdown-item" onclick="prepareDelete('@Model.familyInfo.familyID')"
						   data-deleteid="@Model.familyInfo.familyID" data-bs-toggle="modal" data-bs-target="#deleteConfirmationModal">
							Delete Family
						</a>
					</li>
				</ul>
			</div>
		</div>
	</div>

	<div class="description">
		<p>
			<strong>Street Address:</strong>
			@Model.familyInfo.streetAddress
		</p>
		<p>
			<strong>Barangay:</strong>
			@Model.familyInfo.barangayName
		</p>
		<p>
			<strong>Mobile Number:</strong>
			@Model.familyInfo.mobileNum
		</p>
		<p>
			<strong>Telephone Number:</strong>
			@Model.familyInfo.telephoneNum
		</p>
		<p>
			<strong>Living in Geographically Isolated and Disadvantaged Area (GIDA):</strong>
			@Model.familyInfo.livingInGida
		</p>
		<p>
			<strong>Beneficiary:</strong>
			@Model.familyInfo.beneficiary
		</p>
	</div>
</div>

<div class="content">
    <!-- Title and Allocate Button-->
    <div class="row p-2">
        <div class="col d-flex align-items-center">
            <h1>Family Log</h1>
        </div>

        <div class="col-auto d-flex justify-content-between align-items-center">
            <div class="d-flex justify-content-end align-items-center">
				<a class="btn btn-primary mb-2" href="/family/profile/add/member/?familyID=@Model.familyInfo.familyID">
                    <i class="bi bi-building-add"></i>Add Family Member
                </a>
            </div>
        </div>
    </div>

    <!-- Table -->
    <div class="row p-2">
        <div class="col-lg-12">
            <table id="eclog-table" class="table display compact order-column table-hover" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th>#</th>
						<th>Family Relationship</th>
                        <th>Name</th>
                        <th>Sex</th>
                        <th>Birth Date</th>
						<th>Civil Status</th>
                        <th>Education</th>
                        <th>Occupation</th>
						<th>Religion</th>
						<th>Ethnicity</th>
						<th>Health Condition</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @{ var counter = 1; }
                    @foreach (var item in Model.listFamilyMember)
                    {
                        <tr>
							<td width="20%">@item.relationship</td>
                            <td width="15%">@item.firstName</td>
                            <td width="15%">@item.sex</td>
                            <td width="15%">@item.birthdate</td>
							<td width="15%">@item.civilStatus</td>
							<td width="15%">@item.education</td>
							<td width="15%">@item.occupation</td>
							<td width="15%">@item.religion</td>
							<td width="15%">@item.ethnicity</td>
							<td width="15%">@item.healthCondition</td>
                            <td width="10%">
								<a class="btn btn-success edit-button" href="/family/profile/informationboard/index?familyID=@item.memberID">
                                    View
                                </a>
                            </td>
                        </tr>
                        counter++;
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal: Confirm Delete -->
<div class="modal" id="deleteConfirmationModal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Confirm Delete</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<p>Are you sure you want to delete this family?</p>
				<p><strong class="text-danger">This cannot be undone.</strong></p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
			</div>
		</div>
	</div>
</div>

<!-- For Info Button -->
<script>
	const toggleButton = document.getElementById('toggleButton');
	const description = document.querySelector('.description');

	toggleButton.addEventListener('click', () => {
		if (description.style.display === 'none') {
			description.style.display = 'block';
		} else {
			description.style.display = 'none';
		}
	});
</script>

<!-- Making the table responsive -->
<script>
	$(document).ready(function () {
		$('#eclog-table').DataTable({
			responsive: true,
			columnDefs: [
				{ "orderable": true, "targets": [0, 1, 3, 4, 5, 6, 7, 8, 9, 10] }, // Sortable columns
				{ "orderable": false, "targets": [2] } // Non-sortable columns
			],
			language: {
				emptyTable: "There are no family member to this family.",
			}
		});
	});
</script>

<!-- Confirm Delete button in Modal -->
<script>
	const deleteButtons = document.querySelectorAll('.edit-button');
	let familyIdToDelete = null;

	deleteButtons.forEach(function (button) {
		button.addEventListener('click', function () {
			familyIdToDelete = this.getAttribute('data-deleteid');
		});
	});

	// Function to prepare for delete action
	function prepareDelete(familyID) {
		if (familyID === null || familyID === undefined) {
			// Retrieve familyID from the button's data-deleteid attribute
			familyIdToDelete = event.currentTarget.getAttribute('data-deleteid');
		} else {
			familyIdToDelete = familyID;
		}
	}

	const confirmDeleteButton = document.getElementById('confirmDeleteButton');

	confirmDeleteButton.addEventListener('click', function () {
		if (familyIdToDelete !== null) {
			window.location.href = "/family/profile/delete?familyID=" + familyIdToDelete;
		}
	});
</script>
