@page
@model AgapayAidSystem.Pages.disaster.profile.vulnerabilityassessment.AddModel
@{
    ViewData["Title"] = "Add Vulnerability Assessment";
}

@*<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>*@

@if (Model.UserType == "Admin")
{
	Layout = "_Layout";
}
else if (Model.UserType == "LGU Staff")
{
	Layout = "_Layout - LGU";
}
else if (Model.UserType == "EC Staff")
{
	Layout = "_Layout - ECStaff";
}
else
{
	Layout = "_Login";
}

<!-- Alert Banners -->
@if (!string.IsNullOrEmpty(Model.errorMessage))
{
	<div class="position-fixed top-0 end-0 p-3" style="z-index: 1000;">
		<div class="alert alert-warning alert-dismissible fade show" role="alert">
			<strong>Error: @Model.errorMessage</strong>
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
	</div>
}

@if (!string.IsNullOrEmpty(Request.Query["errorMessage"]))
{
	<div class="position-fixed top-0 end-0 p-3" style="z-index: 1000;">
		<div class="alert alert-warning alert-dismissible fade show" role="alert">
			<strong>Error: @Request.Query["errorMessage"]</strong>
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
	</div>
}

<style>
	table {
		border-collapse: separate;
		border-spacing: 0 10px;
	}

	td {
		padding-right: 20px;
	}

	.additional-info {
		font-style: italic;
		padding: 5px 20px 0px 20px;
	}
</style>

<div class="bg-light rounded px-2 py-0 my-3">
	<h1 class="display-5 fw-bold text-center pt-5">Vulnerability Assessment Index</h1>

	<p class="additional-info">
		This vulnerability assessment form is sourced from page 22 of
		<a href="https://www.dswd.gov.ph/issuances/MCs/MC_2021-013.pdf?fbclid=IwAR0jL8e_0ZgO2pFLCZdSWCChBuxjjqxWKYIv0EB2zQfsidB-vQpPR9CCJGo" target="_blank">
			Memorandum Circular No. 13, Series of 2021 Guidelines in the Implementation of Relief Aid thru Cash Voucher in Disasters and Emergencies (RACVoDE)
		</a>
		and is provided here for reference and attribution purposes on our website.
	</p>

	<div class=" d-flex align-items-center justify-content-center pb-0">
		<table class="text-center">
			<thead>
				<tr>
					<th class="text-primary"><b>Score</b></th>
					<th> </th>
					<th class="text-primary"><b>Vulnerability Level</b></th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td class="pe-0">0 - 9</td>
					<td> </td>
					<td class="pe-0">Low</td>
				</tr>
				<tr>
					<td class="pe-0">10 - 18</td>
					<td> </td>
					<td>Medium</td>
				</tr>
				<tr>
					<td class="pe-0">19 - 27</td>
					<td> </td>
					<td class="pe-0">High</td>
				</tr>
			</tbody>
		</table>
	</div>

	<form method="POST" id="assessment">
		<div class="col align-items-center">
			<h4>Select Family</h4>
			<select class="form-select familySelect" name="familyID" required>
				<option value="" selected>Select Family</option>
				@{
					foreach (var item in Model.listVulneFam)
					{
						<option value="@item.familyID">@item.serialNum (@item.familyHead)</option>
					}
				}
			</select>
		</div>

		<br />

		<div class="col d-flex align-items-center">
			<h4>Primary Indicators</h4>
		</div>

		<div class="col d-flex align-items-center">
			<h6><small>(Yes - 2 / No - 0)</small></h6>
		</div>

		<!-- Primary -->
		<table style="width:100%">
			<tbody>
				@{
					var counter = 1;
				}
				@foreach (var item in Model.listPrimary)
				{
					<tr>
						<td width="2%">@counter.</td>
						<td style="text-align:left;">
							@item.questionText
						</td>
						<td width="7%">
							<input type="radio" class="radio-group" name="@item.questionID" value="Yes"> Yes
						</td>
						<td width="7%">
							<input type="radio" class="radio-group" name="@item.questionID" value="No"> No
						</td>
					</tr>
					counter++;
				}
		</table>
		<br />

		<!-- Secondary -->
		<div class="col d-flex align-items-center">
			<h4>Secondary Indicators</h4>
		</div>

		<div class="col d-flex align-items-center">
			<h6><small>(Yes - 1 / No - 0)</small></h6>
		</div>

		<table style="width:100%">
			<tbody>
				@{
					var counter2 = 1;
				}
				@foreach (var item in Model.listSecondary)
				{
					<tr>
						<td width="2%">@counter2.</td>
						<td style="text-align:left;">
							@item.questionText
						</td>
						<td width="7%">
							<input type="radio" class="radio-group" name="@item.questionID" value="Yes"> Yes
						</td>
						<td width="7%">
							<input type="radio" class="radio-group" name="@item.questionID" value="No"> No
						</td>
					</tr>
					counter2++;
				}
		</table>

		<br />

		<!-- Cancel and Add Button -->
		<div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
			<a href="/disaster/profile/vulnerabilityassessment/index?centerLogID=@Model.logInfo.centerLogID" role="button" class="btn btn-outline-secondary px-4 gap-3">Cancel</a>
			<button type="button" class="btn btn-primary" id="submitBtn" name="saveSelection" data-bs-toggle="modal" data-bs-target="#confirmSaveModal" disabled>Add</button>
		</div>
	</form>
</div>

<!-- Select2 for Select Family -->
<script>
	$(document).ready(function () {
		$('select[name="familyID"]').select2();
	});

</script>


<!-- Modal: Confirm Add -->
<div class="modal" id="confirmSaveModal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Confirm Add</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<p>Are you sure you want to add this vulnerability assessment of the selected family?</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-primary" id="confirmSaveButton">Add</button>
			</div>
		</div>
	</div>
</div>


<!-- Add button in Modal -->
<script>
	document.getElementById('confirmSaveButton').addEventListener('click', function () {
		document.getElementById('assessment').submit();
	});
</script>

<!-- Enable/disabled Add button in form -->
<script>
	const submitButton = document.getElementById('submitBtn');
	const form = document.querySelector('form');
	const familySelect = document.querySelector('.familySelect');
	const rows = document.querySelectorAll('tr');

	submitButton.disabled = true;

	function checkFormValidity() {
		const isFamilySelected = familySelect.value !== "";

		let isRadioBtnValid = true;

		rows.forEach(row => {
			const radiosInRow = row.querySelectorAll('input[type="radio"]');
			const isAnyRadioChecked = Array.from(radiosInRow).some(radio => radio.checked);

			if (!isAnyRadioChecked) {
				isRadioBtnValid = false;
			}
		});

		if (isFamilySelected && isRadioBtnValid) {
			submitButton.disabled = false;
		} else {
			submitButton.disabled = true;
		}
	}

	form.addEventListener('input', checkFormValidity);
</script>
